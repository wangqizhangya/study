"use strict";var dlsjfApp=angular.module("xydzpApp",["ngSanitize","ui.bootstrap"]).value("host","");angular.module("xydzpApp").run(function(){FastClick.attach(document.body)}),angular.module("xydzpApp").controller("AppCtrl",["$scope","$timeout","$http","addressService","$modal","host",function(a,b,c,d,e,f){a.app={prizeOpen:!1,thanksOpen:!1,ruleOpen:!1,shareOpen:!1,noChanceOpen:!1,prizeSize:""},a.toast={show:!1,msg:""},a.roulette="",a.prices=[{name:"10M流量"},{name:"1G流量"},{name:"谢谢参与"},{name:"500M流量"},{name:"谢谢参与"},{name:"30M流量"},{name:"谢谢参与"},{name:"100M流量"}];var g={prices:a.prices,duration:5e3,separation:2,min_spins:5,max_spins:10};a.init=function(){a.app.user_name=a.getUrlParam("name"),a.app.phone=a.getUrlParam("phone"),a.roulette=$(".roulette").fortune(g)},a.clickHandler=function(){if(!a.app.phone||!a.app.user_name)return void a.openModal("","下载安装和办公参加幸运大转盘抽奖活动");$(".spinner").off("click");var c={phone:a.app.phone,userName:a.app.user_name,rollType:"4"};d.luckyRoll(c,function(c){if(1==c.status)if(c.data.reward){a.app.prizeSize=c.data.reward.key;var d=0;switch(a.app.prizeSize){case"10M":d=0;break;case"100M":d=1;break;case"30M":d=3;break;case"500M":d=5;break;case"1G":d=7}a.roulette.spin(d).done(function(c){b(function(){a.open("prize"),$(".spinner").on("click",a.clickHandler)},500)})}else{var d=2*Math.floor(3*Math.random()+1);a.roulette.spin(d).done(function(c){b(function(){a.open("thanks"),$(".spinner").on("click",a.clickHandler)},500)})}else $(".spinner").on("click",a.clickHandler),2==c.data.state?a.open("share"):1==c.data.state?a.open("noChance"):a.toast("请稍候重试")},function(b){$(".spinner").on("click",a.clickHandler),a.toast("网络异常，请检查网络连接")})},a.getUrlParam=function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=decodeURI(window.location.search),d=c.substr(1).match(b);return null!=d?unescape(d[2]):null},a.toast=function(c){a.toast.show=!0,a.toast.msg=c,b(function(){a.toast.show=!1,a.toast.msg=""},1e3)},a.open=function(b){switch(b){case"prize":a.app.prizeOpen=!0,a.$apply();break;case"thanks":a.app.thanksOpen=!0,a.$apply();break;case"rule":a.app.ruleOpen=!0;break;case"share":a.app.shareOpen=!0;break;case"noChance":a.app.noChanceOpen=!0}},a.close=function(b){switch(b){case"prize":a.app.prizeOpen=!1;break;case"thanks":a.app.thanksOpen=!1;break;case"rule":a.app.ruleOpen=!1;break;case"share":a.app.shareOpen=!1;break;case"noChance":a.app.noChanceOpen=!1}};var h=["$scope","$modalInstance","message","title",function(a,b,c,d){a.message=c,a.title=d,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}];a.openModal=function(c,d){a.message=d,a.title=c;var f=e.open({templateUrl:"modal.html",controller:h,backdrop:"static",resolve:{message:function(){return a.message},title:function(){return a.title}}});f.result.then(function(){b(function(){window.location.href="http://223.99.141.135:81/"},150)})}}]),function(){var a=angular.module("xydzpApp");a.service("addressService",["ajaxService","$rootScope",function(a,b){var c={luckyRoll:"/eas_cmcc/anniToRoll/luckyRoll"};return{luckyRoll:function(b,d,e){var f={url:c.luckyRoll,data:b};a.post(f,d,e)}}}])}(),function(){var a=angular.module("xydzpApp");a.constant("httpGetConfig",{method:"GET",url:"",cache:!1,transformRequest:function(a){if("object"!==(typeof a).toLocaleLowerCase())return a;var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),a.constant("httpPostConfig",{method:"POST",url:"",cache:!1,timeout:1e4,transformRequest:function(a){if("object"!==(typeof a).toLocaleLowerCase())return a;var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),a.constant("httpPutConfig",{method:"PUT",url:"",transformRequest:function(a){if("object"!==(typeof a).toLocaleLowerCase())return a;var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),a.constant("httpDelConfig",{method:"DELETE",url:"",transformRequest:function(a){if("object"!==(typeof a).toLocaleLowerCase())return a;var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),a.service("ajaxService",["$http","host","$rootScope","httpGetConfig","httpPostConfig","httpPutConfig","httpDelConfig",function(a,b,c,d,e,f,g){b=b||{};var h="",i="";"object"!==(typeof b).toLocaleLowerCase()?h=b:(h=b.prefix||"",i=b.sufffix?"."+b.sufffix:"");var j=!1,k=function(b,c,k,l){switch(b){case"get":var m=d;break;case"post":var m=e;break;case"del":var m=g;break;default:var m=f}if(c){for(var n in m)c[n]=c[n]||m[n];c.url=h+c.url+i,a(c).success(function(a){j=!1,k&&k(a)}).error(function(a){l(a)})}};return{requset:function(a,b,c){k("request",a,b,c)},get:function(a,b,c){var d=a;"object"!==(typeof a).toLocaleLowerCase()&&(d={url:a}),k("get",d,b,c)},post:function(a,b,c){var d=a;"object"!==(typeof a).toLocaleLowerCase()&&(d={url:a}),k("post",d,b,c)},put:function(a,b,c){var d=a;"object"!==(typeof a).toLocaleLowerCase()&&(d={url:a}),k("put",d,b,c)},del:function(a,b,c){var d=a;"object"!==(typeof a).toLocaleLowerCase()&&(d={url:a}),k("del",d,b,c)}}}])}(),function(a){a.fn.fortune=function(b){var c=this,d=b.prices?b.prices:b,e=b.duration||1e3,f=b.separation||0,g=Array.isArray(d)?d.length:d,h=360/g,i=!1,j=b.min_spins||10,k=b.max_spins||15,l=b.onSpinBounce||function(){},m=!0;void 0!==b.clockWise&&(m=b.clockWise),c.spin=function(b,p){("undefined"==typeof p||null===p)&&(p=-1);var q=1;m||(q=-1),b="number"==typeof b?b:Math.floor(Math.random()*g);var r=a.Deferred(),s=Math.floor(h*(b-.5)+o(f,h-f));b<d.length&&void 0!==d[b].length&&(sub_amount=d[b].length,p=Math.floor(Math.random()*sub_amount),s=Math.floor(h*(b-.5)+h/sub_amount*p+o(f,h/sub_amount-f)));var t=o(j,k),u=q*(360*t+q*s),v=0,w=!1;i=!0,c.css({transform:"rotate("+u+"deg)","-webkit-transform":"rotate("+u+"deg)",transition:"transform "+e+"ms cubic-bezier(0.38, 0.14, 0.2, 0.82)","-webkit-transition":"-webkit-transform "+e+"ms cubic-bezier(0.38, 0.14, 0.2, 0.82)"}).siblings(".spin").removeClass("bounce");var x=function(){var a,b=Math.floor(n(c)),d=Math.floor((b+.5*h)%h),e=h/5,f=h/10;v=Math.floor(v>b?v-360*q:v),a=b-v,e>d&&f>a||3*e>d&&a>=f?w||(c.siblings(".spin").addClass("bounce"),l(c.siblings(".spin")),w=!0):(c.siblings(".spin").removeClass("bounce"),w=!1),i&&(v=b,requestAnimationFrame(x))},y=requestAnimationFrame(x);return setTimeout(function(){c.css({transform:"rotate("+s+"deg)","-webkit-transform":"rotate("+s+"deg)",transition:"","-webkit-transition":""}).siblings(".spin").removeClass("bounce"),cancelAnimationFrame(y);var a=d[b]||b;-1!=p&&(a=d[b][p]),r.resolve(a),i=!1},e),r.promise()};var n=function(a){var b=0,c=a.css("-webkit-transform")||a.css("-moz-transform")||a.css("-ms-transform")||a.css("-o-transform")||a.css("transform");if("none"!==c){var b,d=c.split("(")[1].split(")")[0].split(","),e=d[0],f=d[1],g=Math.atan2(f,e);0>g&&(g+=2*Math.PI),b=Math.round(g*(180/Math.PI))}return b},o=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};return c.getCurrentPosition=function(){return n(c)},c}}(jQuery),window.requestAnimationFrame=window.requestAnimationFrame||function(a){return window.setTimeout(a,0)},window.cancelAnimationFrame=window.cancelAnimationFrame||function(a){return window.clearTimeout(a)};